var rangy;rangy=rangy||function(){function e(e,t){var n=typeof e[t];return n==p||!(n!=g||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=g||!e[t])}function n(e,t){return typeof e[t]!=m}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function o(e){return e&&E(e,N)&&O(e,C)}function i(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(n){t(window,"console")&&e(window.console,"log")&&window.console.log(n)}function s(e,t){t?window.alert(e):a(e)}function c(e){w.initialized=!0,w.supported=!1,s("Rangy is not supported on this page in your browser. Reason: "+e,w.config.alertOnFail)}function d(e){s("Rangy warning: "+e,w.config.alertOnWarn)}function f(e){return e.message||e.description||String(e)}function u(){if(!w.initialized){var t,n=!1,r=!1;e(document,"createRange")&&(t=document.createRange(),E(t,v)&&O(t,R)&&(n=!0),t.detach());var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void c("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(r=!0)),!n&&!r)return void c("Neither Range nor TextRange are available");w.initialized=!0,w.features={implementsDomRange:n,implementsTextRange:r};var d,u;for(var l in y)(d=y[l])instanceof h&&d.init();for(var g=0,p=_.length;p>g;++g)try{_[g](w)}catch(m){u="Rangy init listener threw an exception. Continuing. Detail: "+f(m),a(u)}}}function l(e){e=e||window,u();for(var t=0,n=D.length;n>t;++t)D[t](e)}function h(e,t){this.name=e,this.initialized=!1,this.supported=!1,this.init=t}var g="object",p="function",m="undefined",R=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],v=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],C=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],N=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],E=r(e),S=r(t),O=r(n),y={},w={version:"1.3alpha.772",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:E,areHostObjects:S,areHostProperties:O,isTextRange:o,getBody:i},features:{},modules:y,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};w.fail=c,w.warn=d,{}.hasOwnProperty?w.util.extend=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&w.util.extend(r,o,!0),e[i]=o);return e}:c("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(r){}t||(t=function(e){for(var t=[],n=0,r=e.length;r>n;++n)t[n]=e[n];return t}),w.util.toArray=t}();var T;e(document,"addEventListener")?T=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?T=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),w.util.addListener=T;var _=[];w.init=u,w.addInitListener=function(e){w.initialized?e(w):_.push(e)};var D=[];w.addCreateMissingNativeApiListener=function(e){D.push(e)},w.createMissingNativeApi=l,h.prototype={fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){w.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){w.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},w.createModule=function(e,t){var n=new h(e,function(){if(!n.initialized){n.initialized=!0;try{t(w,n),n.supported=!0}catch(r){var o="Module '"+e+"' failed to load: "+f(r);a(o)}}});y[e]=n},w.requireModules=function(e){for(var t,n,r=0,o=e.length;o>r;++r){if(n=e[r],t=y[n],!(t&&t instanceof h))throw new Error("required module '"+n+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+n+"' not supported")}};var A=!1,x=function(){A||(A=!0,w.initialized||u())};return typeof window==m?void c("No window found"):typeof document==m?void c("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",x,!1),T(window,"load",x),w)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==A||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(P(r,n))return n;return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t){return s(e,t,!0)}function d(e,t,n){for(var r,o=n?e:e.parentNode;o;){if(r=o.parentNode,r===t)return o;o=r}return null}function f(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function l(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function h(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),l(r,e),n)for(var i,a=0;i=n[a++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;return r}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=A)return e.ownerDocument;if(typeof e.document!=A)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=g(e);if(typeof n.defaultView!=A)return n.defaultView;if(typeof n.parentWindow!=A)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=A)return e.contentDocument;if(typeof e.contentWindow!=A)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function R(e){if(typeof e.contentWindow!=A)return e.contentWindow;if(typeof e.contentDocument!=A)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function v(e){return e&&x.isHostMethod(e,"setTimeout")&&x.isHostObject(e,"document")}function C(e,t,n){var r;if(e?x.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):v(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function N(e){for(var t;t=e.parentNode;)e=t;return e}function E(e,n,r,i){var s,c,f,u,l;if(e==r)return n===i?0:i>n?-1:1;if(s=d(r,e,!0))return n<=o(s)?-1:1;if(s=d(e,r,!0))return o(s)<i?-1:1;if(c=a(e,r),f=e===c?c:d(e,c,!0),u=r===c?c:d(r,c,!0),f===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=c.firstChild;l;){if(l===f)return-1;if(l===u)return 1;l=l.nextSibling}}function S(e){try{return e.parentNode,!1}catch(t){return!0}}function O(e){if(!e)return"[No node]";if(B&&S(e))return"[Broken node]";if(f(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]["+e.innerHTML.slice(0,20)+"]"}return e.nodeName}function y(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function w(e){this.root=e,this._next=e}function T(e){return new w(e)}function _(e,t){this.node=e,this.offset=t}function D(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var A="undefined",x=e.util;x.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),x.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var b=document.createElement("div");x.areHostMethods(b,["insertBefore","appendChild","cloneNode"]||!x.areHostObjects(b,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),x.isHostProperty(b,"innerHTML")||t.fail("Element is missing innerHTML property");var I=document.createTextNode("test");x.areHostMethods(I,["splitText","deleteData","insertData","appendData","cloneNode"]||!x.areHostObjects(b,["previousSibling","nextSibling","childNodes","parentNode"])||!x.areHostProperties(I,["data"]))||t.fail("Incomplete Text Node implementation");var P=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},B=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",B=S(n),e.features.crashyTextNodes=B}();var H;typeof window.getComputedStyle!=A?H=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=A?H=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},_.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+O(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},D.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},D.prototype.toString=function(){return this.message},e.dom={arrayContains:P,isHtmlNamespace:n,parentElement:r,getNodeIndex:o,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:c,getClosestAncestorIn:d,isCharacterDataNode:f,isTextOrCommentNode:u,insertAfter:l,splitDataNode:h,getDocument:g,getWindow:p,getIframeWindow:R,getIframeDocument:m,getBody:x.getBody,isWindow:v,getContentDocument:C,getRootContainer:N,comparePoints:E,isBrokenNode:S,inspectNode:O,getComputedStyleProperty:H,fragmentFromNodeChildren:y,createIterator:T,DomPosition:_},e.DOMException=D}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(V(e,t.startContainer)||V(e,t.endContainer))}function n(e){return e.document||q(e.startContainer)}function r(e){return new k(e.parentNode,j(e))}function o(e){return new k(e.parentNode,j(e)+1)}function i(e,t,n){var r=11==e.nodeType?e.firstChild:e;return U(t)?n==t.length?L.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:Y(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function a(e,t,r){if(T(e),T(t),n(t)!=n(e))throw new F("WRONG_DOCUMENT_ERR");var o=z(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=z(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?0>=o&&i>=0:0>o&&i>0}function s(e){for(var t,r,o,i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(o=e.getSubtreeIterator(),r.appendChild(s(o)),o.detach(!0)),10==r.nodeType)throw new F("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function c(e,t,n){var r,o;n=n||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,n),a.detach(!0),n.stop)return}else for(r=L.createIterator(i);o=r.next();)if(t(o)===!1)return void(n.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach(!0)):e.remove()}function f(e){for(var t,r,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(f(r)),r.detach(!0)):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function u(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new h(e,!1),function(e){o&&!r.test(e.nodeType)||i&&!n(e)||a.push(e)}),a}function l(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+L.inspectNode(e.startContainer)+":"+e.startOffset+", "+L.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&U(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||U(this.sc)?Q(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||U(this.ec)?Q(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function p(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,X(e,r))return o;o=o.parentNode}return null}}function m(e,t){if(it(e,t))throw new g("INVALID_NODE_TYPE_ERR")}function R(e){if(!e.startContainer)throw new F("INVALID_STATE_ERR")}function v(e,t){if(!X(t,e.nodeType))throw new g("INVALID_NODE_TYPE_ERR")}function C(e,t){if(0>t||t>(U(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function N(e,t){if(rt(e,!0)!==rt(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function E(e){if(ot(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function S(e,t){if(!e)throw new F(t)}function O(e){return $&&L.isBrokenNode(e)||!X(K,e.nodeType)&&!rt(e,!0)}function y(e,t){return t<=(U(e)?e.length:e.childNodes.length)}function w(e){return!!e.startContainer&&!!e.endContainer&&!O(e.startContainer)&&!O(e.endContainer)&&y(e.startContainer,e.startOffset)&&y(e.endContainer,e.endOffset)}function T(e){if(R(e),!w(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function _(e,t){T(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;U(o)&&i>0&&i<o.length&&Y(o,i,t),U(n)&&r>0&&r<n.length&&(n=Y(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=j(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function D(){}function A(e){e.START_TO_START=ut,e.START_TO_END=lt,e.END_TO_END=ht,e.END_TO_START=gt,e.NODE_BEFORE=pt,e.NODE_AFTER=mt,e.NODE_BEFORE_AND_AFTER=Rt,e.NODE_INSIDE=vt}function x(e){A(e),A(e.prototype)}function b(e,t){return function(){T(this);var n,r,i=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,d=new h(this,!0);i!==s&&(n=Q(i,s,!0),r=o(n),i=r.node,a=r.offset),c(d,E),d.reset();var f=e(d);return d.detach(),t(this,i,a,i,a),f}}function I(e,n,i){function a(e,t){return function(n){R(this),v(n,J),v(Z(n),K);var i=(e?r:o)(n);(t?s:c)(this,i.node,i.offset)}}function s(e,t,r){var o=e.endContainer,i=e.endOffset;(t!==e.startContainer||r!==e.startOffset)&&((Z(t)!=Z(o)||1==z(t,r,o,i))&&(o=t,i=r),n(e,t,r,o,i))}function c(e,t,r){var o=e.startContainer,i=e.startOffset;(t!==e.endContainer||r!==e.endOffset)&&((Z(t)!=Z(o)||-1==z(t,r,o,i))&&(o=t,i=r),n(e,o,i,t,r))}e.prototype=new D,W.extend(e.prototype,{setStart:function(e,t){R(this),m(e,!0),C(e,t),s(this,e,t)},setEnd:function(e,t){R(this),m(e,!0),C(e,t),c(this,e,t)},setStartAndEnd:function(){R(this);var e=arguments,t=e[0],r=e[1],o=t,i=r;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}n(this,t,r,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){T(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(this),m(e,!0),n(this,e,0,e,G(e))},selectNode:function(e){R(this),m(e,!1),v(e,J);var t=r(e),i=o(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:b(f,n),deleteContents:b(d,n),canSurroundContents:function(){T(this),E(this.startContainer),E(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){i(this)},splitBoundaries:function(){_(this)},splitBoundariesPreservingPositions:function(e){_(this,e)},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,r=this.endContainer,o=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,o=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(n){var i=n.previousSibling;if(i&&i.nodeType==n.nodeType){e=n;var a=n.length;if(t=i.length,n.insertData(0,i.data),i.parentNode.removeChild(i),e==r)o+=t,r=e;else if(r==n.parentNode){var s=j(n);o==s?(r=n,o=a):o>s&&o--}}},s=!0;if(U(r))r.length==o&&i(r);else{if(o>0){var c=r.childNodes[o-1];c&&U(c)&&i(c)}s=!this.collapsed}if(s){if(U(e))0==t&&a(e);else if(t<e.childNodes.length){var d=e.childNodes[t];d&&U(d)&&a(d)}}else e=r,t=o;n(this,e,t,r,o)},collapseToPoint:function(e,t){R(this),m(e,!0),C(e,t),this.setStartAndEnd(e,t)}}),x(e)}function P(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:L.getCommonAncestor(e.startContainer,e.endContainer)}function B(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=L.getDocument(t),P(e)}function H(e){R(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function M(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,P(this)}e.requireModules(["DomUtil"]);var L=e.dom,W=e.util,k=L.DomPosition,F=e.DOMException,U=L.isCharacterDataNode,j=L.getNodeIndex,V=L.isOrIsAncestorOf,q=L.getDocument,z=L.comparePoints,Y=L.splitDataNode,Q=L.getClosestAncestorIn,G=L.getNodeLength,X=L.arrayContains,Z=L.getRootContainer,$=e.features.crashyTextNodes;h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,U(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!U(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new M(n(this.range));var t=this._current,r=t,o=0,i=t,a=G(t);V(t,this.sc)&&(r=this.sc,o=this.so),V(t,this.ec)&&(i=this.ec,a=this.eo),B(e,r,o,i,a)}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},g.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},g.prototype.toString=function(){return this.message};var J=[1,3,4,5,7,8,10],K=[2,9,11],et=[5,6,10,12],tt=[1,3,4,5,7,8,10,11],nt=[1,3,4,5,7,8],rt=p([9,11]),ot=p(et),it=p([6,10,12]),at=document.createElement("style"),st=!1;try{at.innerHTML="<b>x</b>",st=3==at.firstChild.nodeType}catch(ct){}e.features.htmlParsingConforms=st;var dt=st?function(e){var t=this.startContainer,n=q(t);if(!t)throw new F("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:U(t)&&(r=L.parentElement(t)),r=null===r||"HTML"==r.nodeName&&L.isHtmlNamespace(q(r).documentElement)&&L.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,L.fragmentFromNodeChildren(r)}:function(e){R(this);var t=n(this),r=t.createElement("body");return r.innerHTML=e,L.fragmentFromNodeChildren(r)},ft=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ut=0,lt=1,ht=2,gt=3,pt=0,mt=1,Rt=2,vt=3;D.prototype={compareBoundaryPoints:function(e,t){T(this),N(this.startContainer,t.startContainer);var n,r,o,i,a=e==gt||e==ut?"start":"end",s=e==lt||e==ut?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],z(n,r,o,i)},insertNode:function(e){if(T(this),v(e,tt),E(this.startContainer),V(e,this.startContainer))throw new F("HIERARCHY_REQUEST_ERR");var t=i(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&U(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new h(this,!0);return e=s(r),r.detach(),e},canSurroundContents:function(){T(this),E(this.startContainer),E(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(v(e,nt),!this.canSurroundContents())throw new g("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);i(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new M(n(this)),r=ft.length;r--;)e=ft[r],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&U(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new h(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=j(e);if(!t)throw new F("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>r?o>0?Rt:pt:o>0?mt:vt},comparePoint:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)<0?-1:z(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:dt,toHtml:function(){T(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(T(this),S(e,"NOT_FOUND_ERR"),q(e)!==n(this))return!1;var r=e.parentNode,o=j(e);S(r,"NOT_FOUND_ERR");var i=z(r,o,this.endContainer,this.endOffset),a=z(r,o+1,this.startContainer,this.startOffset);return t?0>=i&&a>=0:0>i&&a>0},isPointInRange:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)>=0&&z(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return a(this,e,!1)},intersectsOrTouchesRange:function(e){return a(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=z(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=z(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==z(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==z(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new g("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==vt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,G(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var o=this.containsRange(t);return t.detach(),o}return this.containsNodeContents(e)},getNodes:function(e,t){return T(this),u(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){R(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){R(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=n(this),o=e.createRange(r);t=t||L.getBody(r),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length,o.detach()),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,d=!1;!d&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),d=!0),n=o;else for(a=r.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return M.rangesEqual(this,e)},isValid:function(){return w(this)},inspect:function(){return l(this)}},I(M,B,H),e.rangePrototype=D.prototype,W.extend(M,{rangeProperties:ft,RangeIterator:h,copyComparisonConstants:x,createPrototypeRange:I,inspect:l,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=M,e.RangeException=g}),rangy.createModule("WrappedRange",function(e,t){e.requireModules(["DomUtil","DomRange"]);var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,c=o.getBody,d=o.getContentDocument,f=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function r(e){for(var t,n=h.length;n--;)t=h[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}function f(e){e.nativeRange.detach(),e.detached=!0;for(var t=h.length;t--;)e[h[t]]=null}var u,l,h=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},s.createPrototypeRange(n,a,f),u=n.prototype,u.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},u.cloneContents=function(){return this.nativeRange.cloneContents()},u.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},u.collapse=function(e){this.nativeRange.collapse(e),r(this)},u.cloneRange=function(){return new n(this.nativeRange.cloneRange())},u.refresh=function(){r(this)},u.toString=function(){return this.nativeRange.toString()};var g=document.createTextNode("test");c(document).appendChild(g);var p=document.createRange();p.setStart(g,0),p.setEnd(g,0);try{p.setStart(g,1),u.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},u.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},l=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(m){u.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},u.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}u.setStartBefore=l("setStartBefore","setEndBefore"),u.setStartAfter=l("setStartAfter","setEndAfter"),u.setEndBefore=l("setEndBefore","setStartBefore"),u.setEndAfter=l("setEndAfter","setStartAfter"),p.selectNodeContents(g),u.selectNodeContents=p.startContainer==g&&p.endContainer==g&&0==p.startOffset&&p.endOffset==g.length?function(e){this.nativeRange.selectNodeContents(e),r(this)}:function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},p.selectNodeContents(g),p.setEnd(g,3);var R=document.createRange();R.selectNodeContents(g),R.setEnd(g,4),R.setStart(g,2),u.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,R)&&1==p.compareBoundaryPoints(p.END_TO_START,R)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var C=v.firstChild,N=c(document);N.appendChild(v),p.setStart(C,1),p.setEnd(C,2),p.deleteContents(),"13"==C.data&&(u.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},u.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),N.removeChild(v),N=null,i.isHostMethod(p,"createContextualFragment")&&(u.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(g),p.detach(),R.detach(),u.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},l=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(o.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var d=new a(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var u=o.getDocument(c).createElement("span");u.parentNode&&u.parentNode.removeChild(u);for(var l,h,g,p,m,R=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==c?i.nodeIndex:0,C=c.childNodes.length,N=C,E=N;;){if(E==C?c.appendChild(u):c.insertBefore(u,c.childNodes[E]),s.moveToElementText(u),l=s.compareEndPoints(R,e),0==l||v==N)break;if(-1==l){if(N==v+1)break;v=E}else N=N==v+1?v:E;E=Math.floor((v+N)/2),c.removeChild(u)}if(m=u.nextSibling,-1==l&&m&&f(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(m.data)){var O=s.duplicate(),y=O.text.replace(/\r\n/g,"\r").length;for(S=O.moveStart("character",y);-1==(l=O.compareEndPoints("StartToEnd",O));)S++,O.moveStart("character",1)}else S=s.text.length;p=new a(m,S)}else h=(r||!n)&&u.previousSibling,g=(r||n)&&u.nextSibling,p=g&&f(g)?new a(g,0):h&&f(h)?new a(h,h.data.length):new a(c,o.getNodeIndex(u));return u.parentNode.removeChild(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},g=function(e,t){var n,r,i,a,s=e.offset,d=o.getDocument(e.node),u=c(d).createTextRange(),l=f(e.node);return l?(n=e.node,r=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,r=e.node),i=d.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),u.moveToElementText(i),u.collapse(!t),r.removeChild(i),l&&u[t?"moveStart":"moveEnd"]("character",s),u};if(r=function(e){this.textRange=e,this.refresh()},r.prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r=u(this.textRange);l(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(n=h(this.textRange,r,!0,!1),e=n.boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r),r.rangeToTextRange=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var p=function(){return this
}();"undefined"==typeof p.Range&&(p.Range=r),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return"string"==typeof e?"backward"==e:!!e}function r(e,n){if(e){if(T.isWindow(e))return e;if(e instanceof m)return e.win;var r=T.getContentDocument(e,t,n);return T.getWindow(r)}return window}function o(e){return r(e,"getWinSelection").getSelection()}function i(e){return r(e,"getDocSelection").document.selection}function a(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function s(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof A?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof x?n=t.nativeRange:P.implementsDomRange&&t instanceof T.getWindow(t.startContainer).Range&&(n=t),n}function f(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!T.isAncestorOf(e[0],e[t]))return!1;return!0}function u(e){var n=e.getNodes();if(!f(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function l(e){return!!e&&"undefined"!=typeof e.text}function h(e,t){var n=new x(t);e._ranges=[n],a(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(l(n))h(t,n);else{t.rangeCount=n.length;for(var r,o=H(n.item(0)),i=0;i<t.rangeCount;++i)r=e.createRange(o),r.selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,a(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,n){for(var r=e.docSelection.createRange(),o=u(n),i=H(r.item(0)),a=M(i).createControlRange(),s=0,c=r.length;c>s;++s)a.add(r.item(s));try{a.add(o)}catch(d){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),g(e)}function m(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function v(e,t){for(var n,r,o=J.length;o--;)if(n=J[o],r=n.selection,"deleteAll"==t)R(r);else if(n.win==e)return"delete"==t?(J.splice(o,1),!0):r;return"deleteAll"==t&&(J.length=0),null}function C(e,n){for(var r,o=H(n[0].startContainer),i=M(o).createControlRange(),a=0;rangeCount>a;++a){r=u(n[a]);try{i.add(r)}catch(s){throw t.createError("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),g(e)}function N(e,t){if(e.win.document!=H(t))throw new b("WRONG_DOCUMENT_ERR")}function E(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,r)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,r)),this.setSingleRange(o,this.isBackward())}}function S(e){var t=[],n=new I(e.anchorNode,e.anchorOffset),r=new I(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var i=0,a=e.rangeCount;a>i;++i)t[i]=A.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var O,y,w="boolean",T=e.dom,_=e.util,D=_.isHostMethod,A=e.DomRange,x=e.WrappedRange,b=e.DOMException,I=T.DomPosition,P=e.features,B="Control",H=T.getDocument,M=T.getBody,L=A.rangesEqual,W=D(window,"getSelection"),k=_.isHostObject(document,"selection");P.implementsWinGetSelection=W,P.implementsDocSelection=k;var F=k&&(!W||e.config.preferTextRange);F?(O=i,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||H(n.createRange().parentElement())==t}):W?(O=o,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=O;var U=O(),j=e.createNativeRange(document),V=M(document),q=_.areHostProperties(U,["anchorNode","focusNode","anchorOffset","focusOffset"]);P.selectionHasAnchorAndFocus=q;var z=D(U,"extend");P.selectionHasExtend=z;var Y="number"==typeof U.rangeCount;P.selectionHasRangeCount=Y;var Q=!1,G=!0;_.areHostMethods(U,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof U.rangeCount&&P.implementsDomRange&&!function(){var e=window.getSelection();if(e){var t=M(document),n=t.appendChild(document.createElement("div"));n.contentEditable="false";var r=n.appendChild(document.createTextNode("   ")),o=document.createRange();o.setStart(r,1),o.collapse(!0),e.addRange(o),G=1==e.rangeCount,e.removeAllRanges();var i=o.cloneRange();o.setStart(r,0),i.setEnd(r,3),i.setStart(r,2),e.addRange(o),e.addRange(i),Q=2==e.rangeCount,t.removeChild(n),e.removeAllRanges(),o.detach(),i.detach()}}(),P.selectionSupportsMultipleRanges=Q,P.collapsedNonEditableSelectionsSupported=G;var X,Z=!1;V&&D(V,"createControlRange")&&(X=V.createControlRange(),_.areHostProperties(X,["item","add"])&&(Z=!0)),P.implementsControlRange=Z,y=q?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var $;D(U,"getRangeAt")?$=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:q&&($=function(t){var n=H(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r});var J=[],K=function(e){if(e&&e instanceof m)return e.refresh(),e;e=r(e,"getNativeSelection");var t=v(e),n=O(e),o=k?i(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new m(n,o,e),J.push({win:e,selection:t})),t};e.getSelection=K,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(T.getIframeWindow(n))};var et=m.prototype;if(!F&&q&&_.areHostMethods(U,["removeAllRanges","addRange"])){et.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var tt=function(t,n){var r=A.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(d(o)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};et.addRange=Y?function(t,r){if(Z&&k&&this.docSelection.type==B)p(this,t);else if(n(r)&&z)tt(this,t);else{var o;if(Q?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(d(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var i=$(this.nativeSelection,this.rangeCount-1);i&&!L(i,t)&&(t=new x(i))}this._ranges[this.rangeCount-1]=t,a(this,t,ot(this.nativeSelection)),this.isCollapsed=y(this)}else this.refresh()}}:function(e,t){n(t)&&z?tt(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},et.setRanges=function(e){if(Z&&e.length>1)C(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(D(U,"empty")&&D(j,"select")&&Z&&F))return t.fail("No means of selecting a Range or TextRange was found"),!1;et.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=H(this.anchorNode);else if(this.docSelection.type==B){var t=this.docSelection.createRange();t.length&&(e=H(t.item(0)))}if(e){var n=M(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}c(this)},et.addRange=function(e){this.docSelection.type==B?p(this,e):(x.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,a(this,e,!1))},et.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?C(this,e):t&&this.addRange(e[0])}}et.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new b("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var nt;if(F)nt=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=M(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==B?g(t):l(n)?h(t,n):c(t)};else if(D(U,"getRangeAt")&&"number"==typeof U.rangeCount)nt=function(t){if(Z&&k&&t.docSelection.type==B)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));a(t,t._ranges[t.rangeCount-1],ot(t.nativeSelection)),t.isCollapsed=y(t)}else c(t)};else{if(!q||typeof U.isCollapsed!=w||typeof j.collapsed!=w||!P.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;nt=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=$(n,0),e._ranges=[t],e.rangeCount=1,s(e),e.isCollapsed=y(e)):c(e)}}et.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(nt(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!L(t[o],this._ranges[o]))return!0;return!1}};var rt=function(t,n){var r=t.getAllRanges();t.removeAllRanges();for(var o=0,i=r.length;i>o;++o)e.rangesEqual(n,r[o])||t.addRange(r[o]);t.rangeCount||c(t)};et.removeRange=Z?function(e){if(this.docSelection.type==B){for(var t,n=this.docSelection.createRange(),r=u(e),o=H(n.item(0)),i=M(o).createControlRange(),a=!1,s=0,c=n.length;c>s;++s)t=n.item(s),t!==r||a?i.add(n.item(s)):a=!0;i.select(),g(this)}else rt(this,e)}:function(e){rt(this,e)};var ot;!F&&q&&P.implementsDomRange?(ot=function(e){var t=!1;return e.anchorNode&&(t=1==T.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},et.isBackward=function(){return ot(this)}):ot=et.isBackward=function(){return!1},et.isBackwards=et.isBackward,et.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},et.collapse=function(t,n){N(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},et.collapseToStart=function(){if(!this.rangeCount)throw new b("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},et.collapseToEnd=function(){if(!this.rangeCount)throw new b("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},et.selectAllChildren=function(t){N(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},et.deleteFromDocument=function(){if(Z&&k&&this.docSelection.type==B){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;o>r;++r)n[r].deleteContents();this.addRange(n[o-1])}}},et.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},et.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},et.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},et.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t))}),n},et.setStart=E(!0),et.setEnd=E(!1),e.rangePrototype.select=function(e){K(this.getDocument()).setSingleRange(this,e)},et.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},et.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},et.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},et.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)r=e.createRange(this.win),r.moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},et.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},et.getName=function(){return"WrappedSelection"},et.inspect=function(){return S(this)},et.detach=function(){v(this.win,"delete"),R(this)},m.detachAll=function(){v(null,"deleteAll")},m.inspect=S,m.isDirectionBackward=n,e.Selection=m,e.selectionPrototype=et,e.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return K(e)}),e=null})});